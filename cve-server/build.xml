<?xml version="1.0"?>

<!--
/* @version $Id$
 * 
 * Copyright (c) 2007 Computer Arts Lab, University of Aizu. All rights reserved.
 *
 * CVE Server
 *
 */
 -->

<project name="cve-server" default="jar">

  <target name="init">
    <!-- Set global properties for this build -->
    <property name="src"           location="src"/>
    <property name="build"         location="build"/>
    <property name="dist"          location="dist"/>
    <property name="output.jar"    location="dist/cve-server.jar"/>
  	<property name="package" value="cve.server"/>
  	<property name="mainClass" value="${package}.CVEServer"/>
  </target>

  <target name="compile" depends="init-compile">
    <!-- Create the build directory -->
    <mkdir dir="${build}/classes"/>
    
    <!-- Compile the java code -->
    <javac srcdir="${src}/classes" 
           destdir="${build}/classes"
	   source="1.6"
	   target="1.6"
	   debug="true"
           deprecation="on">
      <classpath refid="compile.classpath"/>
    </javac>
  </target>	
  
  <target name="jar" depends="init,compile">
    <!-- Create the dist directory -->
    <mkdir dir="${dist}"/>
    
    <!-- Create the jar file -->
    <jar jarfile="${output.jar}"
         update="no"
    	compress="true" filesetmanifest="mergewithoutmain">
    	<manifest>
            <attribute name="Built-By" value="${user.name}"/>
            <attribute name="Main-Class" value="${mainClass}"/>
            <attribute name="Class-Path" value="."/>
        </manifest>
	<fileset dir="${build}/classes" includes="**"/>
    </jar>
  </target>
	
  <target name="cleanjar" depends="clean,jar">
  </target>
  
  <target name="clean" depends="init">
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>
  
  <target name="init-compile" depends="init">
    <path id="compile.classpath">
    </path>	
  </target>

  <target name="init-run" depends="init,jar">
    <path id="run.classpath">
      <pathelement location="${output.jar}"/>
    </path>
  </target>
  
  <target name="run" depends="init-run">
  	<!-- fork parameter must be set to false for MacOSX: Bug in Ant 1.8.2 -->
  	<!-- 15.05.2012 Rasika Ranaweera -->
    <java fork="false"
          classname="cve.server.CVEServer">
      <classpath refid="run.classpath"/>
      <jvmarg value="-Djava.util.logging.config.file=./logging.properties"/>
    </java>
  </target>
  
</project>
